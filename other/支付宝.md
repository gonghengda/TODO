## 目录

- [转账到支付宝](#转账到支付宝)


## 转账到支付宝

  ```
  var axios = require ('axios');
  var notify_url="......."
  var baseParams = {
    app_id:'2020202020202020',
    charset: 'utf-8',
    format:'JSON',
    sign:'',
    sign_type:'RSA2',
    timestamp:moment(new Date()).format('YYYY-MM-DD HH:mm:ss'),
    version:"1.0"
  }

  var transferParams = Object.assign({
    method:"alipay.trade.app.pay",
    biz_content:{
      out_biz_no:null,
      payee_type:'ALIPAY_LOGONID',
      payee_account:null,
      amount:0,
      payer_show_name:'付款方姓名',
      payee_real_name:null,
      remark:'转账备注'
    }
  },baseParams)

  getTransferUrl:function(transfer_id){
    return new Promise(fucntion(resolve,reject){
      var biz_content = {
        out_biz_no:`ZP_1`,
        payee_type:'ALIPAY_LOGONID',
        payee_account:110110110,
        amount:10,
        payer_show_name:'转账付款方姓名',
        payer_real_name:'收款真实姓名',
        remark:'转账备注'
      };
      // 构建签名对象
      var singObj = transferParams ;
      signObj.biz_content = JSON.stringify(biz_content);
      // 签名
      resolve(SignTool.getUrl(signObj));
    }).catch(function(err){
      reject(err);
      })
  }

  ...


  Transfer:function(req,res){
    var transfer_id = req.params.transfer_id;
    if(!transfer_id) return res.json({code:1,message:'转账id未传'})
    return this.getTransferUrl(transfer_id).then(function(url){
      var domain = 'https://openapi.alipay.com/gateway.do' ;
      return axios.get(`${domain}?${url}`).then(function(response){
         var transfer = response.data.alipay_fund_trans_toaccount_transfer_response ;
         if(transfer.code ==='10000'){
           ...
            res.json({code:0,message:'转账成功'})
         }else{
          res.json({code:1,message:'转账失败'})
         } 
      }).catch(function(err){
        res.json({code:1,message:'转账失败'})
      })
    })
  }


  ```
